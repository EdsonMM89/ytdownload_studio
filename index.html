<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>YTDOWNLOAD Studio</title>
<style>
    body {
        background-color: #121212;
        color: #f1f1f1;
        font-family: Consolas, monospace;
        margin: 0;
        padding: 0;
    }
    header {
        background: #202020;
        padding: 10px 20px;
        font-size: 22px;
        font-weight: bold;
        color: #ff4444;
        text-align: center;
        border-bottom: 2px solid #ff4444;
    }
    nav {
        display: flex;
        justify-content: center;
        background: #1a1a1a;
        border-bottom: 1px solid #333;
    }
    nav button {
        background: none;
        border: none;
        color: #f1f1f1;
        padding: 12px 20px;
        font-size: 16px;
        cursor: pointer;
        transition: 0.3s;
    }
    nav button:hover, nav button.active {
        background: #333;
        color: #ff4444;
    }
    main {
        display: flex;
        padding: 20px;
        gap: 20px;
    }
    .editor {
        flex: 3;
        display: flex;
        flex-direction: column;
    }
    textarea {
        background: #1e1e1e;
        color: #f8f8f8;
        border: 1px solid #333;
        padding: 10px;
        resize: none;
        height: 350px;
        font-family: Consolas, monospace;
        font-size: 14px;
    }
    .run-btn {
        background: #ff4444;
        border: none;
        color: white;
        padding: 12px;
        font-size: 16px;
        cursor: pointer;
        margin-top: 10px;
        border-radius: 5px;
    }
    .console {
        background: #000;
        color: #00ff66;
        border: 1px solid #333;
        padding: 10px;
        height: 200px;
        overflow-y: auto;
        margin-top: 20px;
        font-family: Consolas, monospace;
        position: relative;
    }
    .input-line {
        display: inline-block;
        width: 100%;
        margin-top: 5px;
    }
    .blink {
        display: inline-block;
        width: 8px;
        height: 18px;
        background: #00ff66;
        animation: blink 1s infinite;
        margin-left: 3px;
    }
    @keyframes blink {
        50% { opacity: 0; }
    }
    .sidebar {
        flex: 1;
        background: #1a1a1a;
        border: 1px solid #333;
        padding: 10px;
    }
    .sidebar h3 {
        color: #ff4444;
        text-align: center;
        margin-top: 0;
    }
    .file {
        background: #222;
        padding: 10px;
        margin: 5px 0;
        border: 1px solid #333;
        border-radius: 5px;
        text-align: center;
        cursor: pointer;
    }
    .file:hover {
        background: #333;
    }
    hr {
        border: 0;
        border-top: 1px solid #333;
        margin: 10px 0;
    }
</style>
</head>
<body>

<header>YTDOWNLOAD Studio</header>

<nav>
    <button class="active" data-tab="0" onclick="mostrarTab(0)">Descarga Simple</button>
    <button data-tab="1" onclick="mostrarTab(1)">Playlist</button>
    <button data-tab="2" onclick="mostrarTab(2)">Formatos y Condiciones</button>
</nav>

<main>
    <div class="editor">
        <textarea id="code"></textarea>
        <button class="run-btn" onclick="ejecutarCodigo()">▶ Ejecutar Código</button>
        <div class="console" id="console"><span>> Esperando ejecución...</span></div>
    </div>

    <div class="sidebar">
        <h3>Archivos</h3>
        <div class="file" onclick="cargarEjemplo(0)">simple.ytd</div>
        <div class="file" onclick="cargarEjemplo(1)">playlist.ytd</div>
        <div class="file" onclick="cargarEjemplo(2)">formatos.ytd</div>
        <hr>
        <div class="file" id="uploadBox" onclick="document.getElementById('fileInput').click()"> Subir archivo .txt</div>
        <input type="file" id="fileInput" accept=".txt" style="display:none">
    </div>
</main>

<script>
const ejemplos = [
`FUNCION main() {
    VAR link = '';
    IMPRIMIR 'Ingresa la URL del video:';
    LEER link;
    descargar(link, mp4, 'Video1', 'C:/Videos');
} FIN!`,
`FUNCION main() {
    VAR playlist = '';
    IMPRIMIR 'Ingresa la URL de la PLAYLIST:';
    LEER playlist;
    PARA CADA video EN playlist HACER {
        descargar(video.url, mp3, video.nombre, 'C:/Musica/Playlist');
    } FIN;
} FIN!`,
`FUNCION main() {
    VAR enlaces = ['https://youtu.be/v001' AS 'edits', 'https://youtu.be/v002' AS 'Clase1'];
    VAR formato = '';
    IMPRIMIR 'Selecciona el formato: (mp3/mp4/mkv)';
    LEER formato;
    PARA CADA e EN enlaces HACER {
        SI formato ENTONCES {
            descargar(e.url, mp4, e.nombre, 'D:/Videos');
        }
    } FIN;
} FIN!`
];

document.getElementById("code").value = ejemplos[0];

function mostrarTab(index) {
    document.querySelectorAll("nav button").forEach(btn => btn.classList.remove("active"));
    document.querySelectorAll("nav button")[index].classList.add("active");
    document.getElementById("code").value = ejemplos[index];
    resetTerminal();
    appendLine("> Esperando ejecución...");
}

function resetTerminal() {
    const consola = document.getElementById("console");
    consola.innerHTML = "";
}

function appendLine(texto) {
    const consola = document.getElementById("console");
    consola.innerHTML += "<br>> " + texto;
    consola.scrollTop = consola.scrollHeight;
}

async function ejecutarCodigo() {
    resetTerminal();
    appendLine("Ejecutando...");
    const tab = document.querySelector("nav button.active").innerText;
    await esperar(1000);
    if (tab.includes("Simple")) procesoSimple();
    else if (tab.includes("Playlist")) procesoPlaylist();
    else procesoFormatos();
}

function esperar(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
}

async function leerEntrada(pregunta, opciones) {
    appendLine(pregunta);
    if (opciones) opciones.forEach((opt, i) => appendLine(`${i+1}. ${opt}`));
    appendLine("Ingrese opción:");
    return new Promise(resolve => {
        const consola = document.getElementById("console");
        const input = document.createElement("input");
        input.type = "text";
        input.style.background = "black";
        input.style.color = "#00ff66";
        input.style.border = "none";
        input.style.outline = "none";
        input.style.width = "90%";
        input.autofocus = true;
        const blink = document.createElement("span");
        blink.className = "blink";
        const line = document.createElement("div");
        line.className = "input-line";
        line.appendChild(input);
        line.appendChild(blink);
        consola.appendChild(line);
        input.focus();

        input.addEventListener("keydown", (e)=>{
            if (e.key === "Enter") {
                const valor = input.value.trim();
                line.remove();
                appendLine(`> ${valor}`);
                resolve(valor);
            }
        });
    });
}

async function procesoSimple() {
    const url = await leerEntrada(" Ingresa la URL del video:");
    await esperar(500);
    const formato = await leerEntrada(" Elige formato:", ["mp4", "mkv", "avi", "mov", "wmv", "flv"]);
    await esperar(700);
    const calidad = await leerEntrada(" Elige calidad:", ["144p", "360p", "720p", "1080p", "2K", "4K"]);
    await esperar(800);
    appendLine(`Procesando descarga de ${url} en formato ${formato} (${calidad})...`);
    await esperar(1200);
    appendLine("Conectando al servidor...");
    await esperar(1000);
    appendLine("Descargando...");
    await esperar(1500);
    appendLine("Guardando en C:/Videos");
    await esperar(1000);
    appendLine(" Descarga completada.");
}

async function procesoPlaylist() {
    const url = await leerEntrada(" Ingresa la URL de la PLAYLIST:");
    await esperar(800);
    appendLine(`Cargando playlist desde ${url}...`);
    await esperar(1200);
    appendLine("Lista detectada con 5 videos.");
    const tipo = await leerEntrada("Selecciona formato de descarga:", ["mp3", "mp4"]);
    await esperar(800);
    appendLine(`Descargando videos en formato ${tipo}...`);
    await esperar(2500);
    appendLine(" Playlist descargada correctamente en C:/Musica/Playlist");
}

async function procesoFormatos() {
    const formato = await leerEntrada("Selecciona el formato deseado:", ["mp3", "mp4", "mkv", "flv"]);
    await esperar(700);
    appendLine(`Preparando descarga en formato ${formato}...`);
    await esperar(1200);
    appendLine("Conectando al servidor...");
    await esperar(1000);
    appendLine("Descargando enlaces...");
    await esperar(2000);
    appendLine("Guardando archivos...");
    await esperar(1000);
    appendLine(" Descarga completada.");
}

// Subir archivo .txt
const fileInput = document.getElementById('fileInput');
fileInput.addEventListener('change', (event)=>{
    const file = event.target.files[0];
    if(!file) return;
    if(!file.name.endsWith('.txt')){
        appendLine("Error: solo se permiten archivos .txt");
        return;
    }
    const reader = new FileReader();
    reader.onload = (e)=>{
        const contenido = e.target.result;
        document.getElementById('code').value = contenido;
        resetTerminal();
        appendLine(`> Archivo cargado: ${file.name}`);
        appendLine(`> Puedes editar o ejecutar el código.`);
        document.querySelectorAll("nav button").forEach(b=>b.classList.remove("active"));
    };
    reader.readAsText(file);
});
</script>

</body>
</html>
